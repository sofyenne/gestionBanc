<h1>Fiche de paie</h1>

<div class="row">
  <div class="col-md-10">
    <div class="card" >
      <div class="card-header" ><strong>Formulaire </strong>  Fiche Agent </div>
      <div class="card-body">
        <form class="form-horizontal" [formGroup]="formulaire">

          <!-- FIRST ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="nom"><strong>nom:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="nom"
                class="form-control"
                placeholder="nom"
                formControlName="nom"
                [class.is-invalid]="nom.invalid && (nom.dirty || nom.touched)"
              />
              <small class="text-danger" *ngIf="nom.invalid && (nom.dirty || nom.touched)">
                <div *ngIf="nom.errors.required">champ requis</div>
              </small>
            </div>
              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="prenom"><strong>prenom:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="prenom"
                class="form-control"
                placeholder="prenom"
                formControlName="prenom"
                [class.is-invalid]="prenom.invalid && (prenom.dirty || prenom.touched)"
              />
              <small class="text-danger" *ngIf="prenom.invalid && (prenom.dirty || prenom.touched)">
                <div *ngIf="prenom.errors.required">champ requis</div>
              </small>
            </div>
          </div>

          <!-- SECOND ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="lieu"><strong>lieu:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="lieu"
                class="form-control"
                placeholder="lieu"
                formControlName="lieu"
                [class.is-invalid]="lieu.invalid && (lieu.dirty || lieu.touched)"
              />
              <small class="text-danger" *ngIf="lieu.invalid && (lieu.dirty || lieu.touched)">
                <div *ngIf="lieu.errors.required">champ requis</div>
              </small>
            </div>

              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="adresse"><strong>Adresse:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="adresse"
                class="form-control"
                placeholder="adresse"
                formControlName="adresse"
                [class.is-invalid]="adresse.invalid && (adresse.dirty || adresse.touched)"
              />
              <small class="text-danger" *ngIf="adresse.invalid && (adresse.dirty || adresse.touched)">
                <div *ngIf="adresse.errors.required">champ requis</div>
              </small>
            </div>
          </div>

          <!-- THIRD ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="email"><strong>Email:</strong> </label>
            <div class="col-md-4">
              <input
                type="email"
                id="email"
                class="form-control"
                placeholder="email"
                formControlName="email"
                [class.is-invalid]="email.invalid && (email.dirty || email.touched)"
              />
              <small class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)">
                <div *ngIf="email.errors.required">champ requis</div>
              </small>
            </div>

              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="etatCivile"><strong>etat Civile:</strong> </label>
            <div class="col-md-4">
              <select name="etatCivile" id="etatCivile" class="form-control" formControlName="etatCivile" (change)="rayen()">

                <option value="celibataire">célibataire</option>
                <option value="marié(e)">marié(e)</option>

            </select>
              <small class="text-danger" *ngIf="etatCivile.invalid && (etatCivile.dirty || etatCivile.touched)">
                <div *ngIf="etatCivile.errors.required">champ requis</div>
              </small>
            </div>
          </div>

          <!-- FORTH ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="niveau"><strong>niveau de rémunération :</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="niveau"
                class="form-control"
                placeholder="niveau de rémunération "
                formControlName="niveau"
                [class.is-invalid]="niveau.invalid && (niveau.dirty || niveau.touched)"
              />
              <small class="text-danger" *ngIf="niveau.invalid && (niveau.dirty || niveau.touched)">
                <div *ngIf="niveau.errors.required">champ requis</div>
              </small>
            </div>

              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="nbreEnfants"><strong>nombre Enfants:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="nbreEnfants"
                class="form-control"
                placeholder="NbreEnfants"
                formControlName="nbreEnfants"
                [class.is-invalid]="nbreEnfants.invalid && (nbreEnfants.dirty || nbreEnfants.touched)"
              />
              <small class="text-danger" *ngIf="nbreEnfants.invalid && (nbreEnfants.dirty || nbreEnfants.touched)">
                <div *ngIf="nbreEnfants.errors.required">champ requis</div>
              </small>
            </div>
          </div>


          <!-- FIFTH ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="salaire"><strong>salaire de base:</strong> </label>
            <div class="col-md-4">
              <input
                type="text"
                id="salaire"
                class="form-control"
                placeholder="salaire de base"
                formControlName="salaire"
                [class.is-invalid]="salaire.invalid && (salaire.dirty || salaire.touched)"
              />
              <small class="text-danger" *ngIf="salaire.invalid && (salaire.dirty || salaire.touched)">
                <div *ngIf="salaire.errors.required">champ requis</div>
              </small>
            </div>

              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="dateDeNaissance"><strong>date De Naissance:</strong> </label>
            <div class="col-md-4">
              <input
                type="date"
                id="dateDeNaissance"
                class="form-control"
                placeholder="dateDeNaissance"
                formControlName="dateDeNaissance"
                [class.is-invalid]="dateDeNaissance.invalid && (dateDeNaissance.dirty || dateDeNaissance.touched)"
              />
              <small class="text-danger" *ngIf="dateDeNaissance.invalid && (dateDeNaissance.dirty || dateDeNaissance.touched)">
                <div *ngIf="dateDeNaissance.errors.required">champ requis</div>
              </small>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="rib"><strong>RIB bank:</strong> </label>
            <div class="col-md-4">
              <input
                minlength="20"
                maxlength="20"
                type="text"
                id="rib"
                class="form-control"
                placeholder="RIB bank"
                formControlName="rib"
                [class.is-invalid]="rib.invalid && (rib.dirty || rib.touched)"
              />
              <small class="text-danger" *ngIf="rib.invalid && (rib.dirty || rib.touched)">
                <div *ngIf="rib.errors.required">champ requis</div>
              </small>
            </div></div>
          <!-- SIXTH ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="bank"><strong>bank:</strong> </label>
            <div class="col-md-4">

                <ng-select [items]="bankList"
                  bindLabel="code"
                  appearance="outline"
                  class="form-control"
                  formControlName="bank"
                  style="padding: 0;"

                  >
                </ng-select>
                <span>{{formulaire.value.bank?.libelle}}</span>

            </div>

              <!-- 2nd input same row -->
              <label class="col-md-2 col-form-label" for="affectation"><strong>Affectation:</strong> </label>
            <div class="col-md-4">
              <ng-select [items]="affectationList"
                  bindLabel="code"
                  appearance="outline"
                  class="form-control"
                  formControlName="affectation"
                  style="padding: 0;"

                  >
                </ng-select>
                <span>{{formulaire.value.affectation?.libelle}}</span>
            </div>
          </div>

          <!-- SEVENTH ROW -->

          <div class="form-group row">
            <label class="col-md-2 col-form-label" for="corps"><strong>corps:</strong> </label>
            <div class="col-md-4">
              <ng-select [items]="corpsList"
                         bindLabel="code"
                         id="corps"
                         appearance="outline"
                         class="form-control"
                         formControlName="corps"
                         style="padding: 0;"
                         (change) = "getGrade($event)"
              >
              </ng-select>
              <span>{{formulaire.value.corps?.libelle}}</span>
            </div>




            <label class="col-md-2 col-form-label" for="grade"><strong>Grade:</strong> </label>
            <div class="col-md-4">
              <ng-select [items]= "pixels"
                bindLabel="code" id="grade"
                appearance="outline"
                class="form-control"
                formControlName="grade"
                style="padding: 0;"
                >
              </ng-select>
              <span>{{formulaire.value.grade?.libelle}}</span>
            </div>

              <!-- 2nd input same row -->

          </div>

          <div class="card-footer">
            <button
              type="submit"
              class="btn btn-sm btn-primary"
              [disabled]="formulaire.invalid"
              (click)="saveForm()"
            >
              <i class="fa fa-dot-circle-o"></i> Confirmer
            </button>
            <button
              type="reset"
              class="btn btn-sm btn-danger"
              (click)="resetForm()"
            >
              <i class="fa fa-ban"></i> Ignorer
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Table -->
<div class="animated fadeIn" *ngIf="source">
  <div class="row card">
      <div class="card-header col-12">
          <i class="fa fa-users"></i><span>Tableau fiche Agent</span>
          <input #search
           class="ml-1"
           size="40"
           type="text"
           placeholder="Cherchez par code ou libelle"
           (input)="onSearch(search.value)"
          />
          <i class="fa fa-search ml-1"></i>
      </div>
      <div class="card-body table-responsive ">
          <ng2-smart-table
           [settings]='settings'
           [source]='source'
           (delete)='deleteFiche($event)'
           (edit)='openModal(template,$event)'>
          </ng2-smart-table>
      </div>
  </div>
</div>


<!-- UPDATE TEMPLATE -->
<ng-template   #template>
  <div class="card modal-xl" >
    <div class="card-header" ><strong>Formulaire </strong>  Fiche de paie </div>
    <div class="card-body">
      <form class="form-horizontal" [formGroup]="formulaire">

        <!-- FIRST ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="nom"><strong>nom:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="nom"
              class="form-control"
              placeholder="nom"
              formControlName="nom"
              [class.is-invalid]="nom.invalid && (nom.dirty || nom.touched)"
            />
            <small class="text-danger" *ngIf="nom.invalid && (nom.dirty || nom.touched)">
              <div *ngIf="nom.errors.required">champ requis</div>
            </small>
          </div>
            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="prenom"><strong>prenom:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="prenom"
              class="form-control"
              placeholder="prenom"
              formControlName="prenom"
              [class.is-invalid]="prenom.invalid && (prenom.dirty || prenom.touched)"
            />
            <small class="text-danger" *ngIf="prenom.invalid && (prenom.dirty || prenom.touched)">
              <div *ngIf="prenom.errors.required">champ requis</div>
            </small>
          </div>
        </div>

        <!-- SECOND ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="lieu"><strong>lieu:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="lieu"
              class="form-control"
              placeholder="lieu"
              formControlName="lieu"
              [class.is-invalid]="lieu.invalid && (lieu.dirty || lieu.touched)"
            />
            <small class="text-danger" *ngIf="lieu.invalid && (lieu.dirty || lieu.touched)">
              <div *ngIf="lieu.errors.required">champ requis</div>
            </small>
          </div>

            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="adresse"><strong>Adresse:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="adresse"
              class="form-control"
              placeholder="adresse"
              formControlName="adresse"
              [class.is-invalid]="adresse.invalid && (adresse.dirty || adresse.touched)"
            />
            <small class="text-danger" *ngIf="adresse.invalid && (adresse.dirty || adresse.touched)">
              <div *ngIf="adresse.errors.required">champ requis</div>
            </small>
          </div>
        </div>

        <!-- THIRD ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="email"><strong>Email:</strong> </label>
          <div class="col-md-4">
            <input
              type="email"
              id="email"
              class="form-control"
              placeholder="email"
              formControlName="email"
              [class.is-invalid]="email.invalid && (email.dirty || email.touched)"
            />
            <small class="text-danger" *ngIf="email.invalid && (email.dirty || email.touched)">
              <div *ngIf="email.errors.required">champ requis</div>
            </small>
          </div>

            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="etatCivile"><strong>etat Civile:</strong> </label>
          <div class="col-md-4">

            <select name="etatCivile" id="etatCivile" class="form-control" formControlName="etatCivile" >

              <option value="celibataire">cilebataire</option>
              <option value="marié(e)">marié(e)</option>

          </select>

            <small class="text-danger" *ngIf="etatCivile.invalid && (etatCivile.dirty || etatCivile.touched)">
              <div *ngIf="etatCivile.errors.required">champ requis</div>
            </small>
          </div>
        </div>

        <!-- FORTH ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="niveau"><strong>niveau:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="niveau"
              class="form-control"
              placeholder="niveau"
              formControlName="niveau"
              [class.is-invalid]="niveau.invalid && (niveau.dirty || niveau.touched)"
            />
            <small class="text-danger" *ngIf="niveau.invalid && (niveau.dirty || niveau.touched)">
              <div *ngIf="niveau.errors.required">champ requis</div>
            </small>
          </div>

            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="nbreEnfants"><strong>nombre Enfants:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="nbreEnfants"
              class="form-control"
              placeholder="nbreEnfants"
              formControlName="nbreEnfants"
              [class.is-invalid]="nbreEnfants.invalid && (nbreEnfants.dirty || nbreEnfants.touched)"
            />
            <small class="text-danger" *ngIf="nbreEnfants.invalid && (nbreEnfants.dirty || nbreEnfants.touched)">
              <div *ngIf="nbreEnfants.errors.required">champ requis</div>
            </small>
          </div>
        </div>


        <!-- FIFTH ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="salaire"><strong>salaire:</strong> </label>
          <div class="col-md-4">
            <input
              type="text"
              id="salaire"
              class="form-control"
              placeholder="salaire"
              formControlName="salaire"
              [class.is-invalid]="salaire.invalid && (salaire.dirty || salaire.touched)"
            />
            <small class="text-danger" *ngIf="salaire.invalid && (salaire.dirty || salaire.touched)">
              <div *ngIf="salaire.errors.required">champ requis</div>
            </small>
          </div>

            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="dateDeNaissance"><strong>date De Naissance:</strong> </label>
          <div class="col-md-4">
            <input
              type="date"
              id="dateDeNaissance"
              class="form-control"
              placeholder="dateDeNaissance"
              formControlName="dateDeNaissance"
              [class.is-invalid]="dateDeNaissance.invalid && (dateDeNaissance.dirty || dateDeNaissance.touched)"
            />
            <small class="text-danger" *ngIf="dateDeNaissance.invalid && (dateDeNaissance.dirty || dateDeNaissance.touched)">
              <div *ngIf="dateDeNaissance.errors.required">champ requis</div>
            </small>
          </div>
        </div>

        <!-- SIXTH ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="bank"><strong>bank:</strong> </label>
          <div class="col-md-4">

              <ng-select [items]="bankList"
                bindLabel="code"
                appearance="outline"
                class="form-control"
                formControlName="bank"
                style="padding: 0;"

                >
              </ng-select>
              <span>{{formulaire.value.bank?.libelle}}</span>

          </div>

            <!-- 2nd input same row -->
            <label class="col-md-2 col-form-label" for="affectation"><strong>Affectation:</strong> </label>
          <div class="col-md-4">
            <ng-select [items]="affectationList"
                bindLabel="code"
                appearance="outline"
                class="form-control"
                formControlName="affectation"
                style="padding: 0;"

                >
              </ng-select>
              <span>{{formulaire.value.affectation?.libelle}}</span>
          </div>
        </div>

        <!-- SEVENTH ROW -->

        <div class="form-group row">
          <label class="col-md-2 col-form-label" for="corps"><strong>corps:</strong> </label>
          <div class="col-md-4">
            <ng-select [items]="corpsList"
                       bindLabel="code"
                       id="corps"
                       appearance="outline"
                       class="form-control"
                       formControlName="corps"
                       style="padding: 0;"
                       (change) = "getGrade($event)"
            >
            </ng-select>
            <span>{{formulaire.value.corps?.libelle}}</span>
          </div>




          <label class="col-md-2 col-form-label" for="grade"><strong>Grade:</strong> </label>
          <div class="col-md-4">
            <ng-select [items]= "pixels"
                       bindLabel="code" id="grade"
                       appearance="outline"
                       class="form-control"
                       formControlName="grade"
                       style="padding: 0;"
            >
            </ng-select>
            <span>{{formulaire.value.grade?.libelle}}</span>
          </div>

          <!-- 2nd input same row -->

        </div>
        <div class="card-footer">
          <button
            type="submit"
            class="btn btn-sm btn-primary"
            [disabled]="formulaire.invalid"
            (click)="updateFiche()"
          >
            <i class="fa fa-dot-circle-o"></i> Modifier
          </button>
          <button
            type="reset"
            class="btn btn-sm btn-danger"
            (click)="closeModal()"
          >
            <i class="fa fa-ban"></i> Annuler
          </button>
        </div>
      </form>
    </div>
  </div>
</ng-template>